<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:DbPad.ViewModels"
             x:Class="DbPad.Views.TabControlView"
             x:DataType="vm:MainWindowViewModel"
             xmlns:extension="clr-namespace:DbPad.Extensions">
    <TabControl ItemsSource="{Binding Tabs}" SelectedItem="{Binding SelectedTab}">
        <TabControl.ItemTemplate>
            <DataTemplate>
                <DockPanel VerticalAlignment="Stretch">
                    <Button DockPanel.Dock="Right"
                            Margin="5,0,0,0"
                            Padding="5,0"
                            Content="x"
                            FontSize="12"
                            VerticalContentAlignment="Center"
                            HorizontalContentAlignment="Center"
                            Command="{Binding $parent[TabControl].DataContext.RemoveTabCommand}"
                            CommandParameter="{Binding}"
                            Background="Transparent"
                            BorderThickness="0,0,0,0"
                            ToolTip.Tip="Закрыть вкладку">
                        <Button.Styles>
                            <Style Selector="Button:pointerover /template/ ContentPresenter">
                                <Setter Property="Background" Value="LightGray" />
                                <Setter Property="CornerRadius" Value="2" />
                            </Style>
                        </Button.Styles>
                    </Button>
                    <TextBlock Text="{Binding TabCaption, FallbackValue=Tab}"
                               VerticalAlignment="Center"
                               ToolTip.Tip="{Binding TabCaption}" />
                </DockPanel>
            </DataTemplate>
        </TabControl.ItemTemplate>
        <TabControl.ContentTemplate>
            <DataTemplate x:DataType="vm:TabItemModel">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>
                    <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,0">
                        <Button Content="Run" Command="{Binding ExecuteSQLCommand}"/>
                    </StackPanel>
                    <TextBox Grid.Row="1"
                             MinHeight="300"
                             Text="{Binding Query, Mode=TwoWay}"
                             AcceptsReturn="True"
                             VerticalContentAlignment="Top"/>
                    <TextBox Grid.Row="2" Text="{Binding Results, Mode=TwoWay}" Watermark="Text 2"/>
                    <DataGrid Grid.Row="3" ItemsSource="{Binding DbResults}" extension:DataGridColumnHelper.DeriveExpandoColumns="True"/>
                </Grid>
            </DataTemplate>
        </TabControl.ContentTemplate>
    </TabControl>
</UserControl>